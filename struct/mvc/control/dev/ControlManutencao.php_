<?php
namespace cms\control\dev;

use cms\view\dev\ViewZzz;
use cms\control\Control;
use cms\model\Manutencao;
use manguto\cms7\lib\ProcessResult;

class ControlManutencao extends Control
{

    static function RunRouteAnalisys($app)
    {
        $app->get('/dev/manutencao', function () {
            self::PrivativeDevZone();
            {
                $manutencao = Manutencao::EmFuncionamento();
            }            
            ViewZzz::PageDev('manutencao',get_defined_vars());
        });
        
        $app->post('/dev/manutencao', function () {
            self::PrivativeDevZone();
            {
                if(isset($_POST['motivo'])){
                    //ATIVACAO! - ATIVACAO! - ATIVACAO! - ATIVACAO! - ATIVACAO! - ATIVACAO! - ATIVACAO! - ATIVACAO! - ATIVACAO!
                    //ATIVACAO! - ATIVACAO! - ATIVACAO! - ATIVACAO! - ATIVACAO! - ATIVACAO! - ATIVACAO! - ATIVACAO! - ATIVACAO!
                    //ATIVACAO! - ATIVACAO! - ATIVACAO! - ATIVACAO! - ATIVACAO! - ATIVACAO! - ATIVACAO! - ATIVACAO! - ATIVACAO!
                    $manutencao = new Manutencao();
                    $manutencao->setMotivo($_POST['motivo']);
                    $manutencao->save();
                    ProcessResult::setSuccess("Manutenção ativada com sucesso!");
                    CMS::headerLocation('/dev/manutencao');                    
                }else{
                    //DESATIVACAO! - DESATIVACAO! - DESATIVACAO! - DESATIVACAO! - DESATIVACAO! - DESATIVACAO! - DESATIVACAO!
                    //DESATIVACAO! - DESATIVACAO! - DESATIVACAO! - DESATIVACAO! - DESATIVACAO! - DESATIVACAO! - DESATIVACAO!
                    //DESATIVACAO! - DESATIVACAO! - DESATIVACAO! - DESATIVACAO! - DESATIVACAO! - DESATIVACAO! - DESATIVACAO!
                    $manutencao = new Manutencao($_POST['id']);
                    $manutencao->setStatus('inativa');
                    $manutencao->save();
                    ProcessResult::setSuccess("Manutenção desativada com sucesso!");
                    CMS::headerLocation('/dev/manutencao');      
                }
                $manutencao = Manutencao::EmFuncionamento();
            }            
            ViewZzz::PageDev('manutencao',get_defined_vars());
        });
        
    }
}

?>