<?php
namespace cms\control\dev;

use manguto\cms7\lib\Diretorios;
use manguto\cms7\lib\Arquivos;
use manguto\cms7\lib\model\Model_Helper;
use cms\control\Control;
use cms\view\View;

class ControlModels extends Control
{

    static function RunRouteAnalisys($app)
    {
        
        // ----------------------------------------------------------------------
        $app->get('/dev/models', function () {
            self::PrivativeDevZone();
            {
                $models = Model_Helper::get();
            }
            View::PageDev('models', get_defined_vars());
        });
        // ----------------------------------------------------------------------
        $app->get('/dev/models/initialize', function () {
            // self::PrivativeDevZone();
            {
                self::Initializer();
            }
            CMS::headerLocation('/');
        });
    }

    // ##################################################################
    // ##################################################################
    // ##################################################################
    static function Initializer()
    {   
        $models = Diretorios::obterArquivosPastas(SIS_CMS_MODEL_PATH, false, true, false, [
            'php'
        ]);
        // deb($models);
        foreach ($models as $model) {
            $modelClassName = Arquivos::obterNomeArquivo($model, false);
            if ($modelClassName == 'Zzz' || substr($modelClassName, 0, 1) == '_'){
                continue;
            }   
            $modelClassNamePath = Model_Helper::getObjectClassName_by_ClassName($modelClassName);            
            $modelClassNamePath::initialize();            
        }     
    }
}

?>