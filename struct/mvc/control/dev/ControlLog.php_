<?php
namespace cms\control\dev;


use manguto\cms7\lib\Logs;
use manguto\cms7\lib\Datas;
use manguto\cms7\lib\Calendario;
use manguto\cms7\lib\Diretorios;
use manguto\cms7\lib\Arquivos;
use manguto\cms7\lib\Numbers;
use manguto\cms7\lib\CSV;
use cms\view\dev\ViewLog;
use manguto\cms7\lib\ServerHelp;
use cms\control\Control;

class ControlLog extends Control
{

    static function RunRouteAnalisys($app)
    {
        $app->get('/dev/log', function () {
            self::PrivativeDevZone();            
            CMS::headerLocation('/dev/log/dia/' . date(Logger::formato_data_arquivo_diario));
            exit();
        });
        
        $app->get('/dev/log/dia/:day', function ($day) {
            self::PrivativeDevZone();           
            {
                //deb($day);
                $date = new Datas($day,Logger::formato_data_arquivo_diario);
                $datashow = $date->getDate('d/m/Y');
                $ano = $date->getDate('Y');
            }
            
            //deb($day);
            $dayLogs = Logger::getDayLogs($day);
            //deb($dayLogs);
            
            ViewLog::PageDev('log_dia', get_defined_vars());
        });
        
        $app->get('/dev/log/ano/:ano', function ($ano) {
            self::PrivativeDevZone();
            {
                $ano_ant = intval($ano)-1;
                $ano_post = intval($ano)+1;
            }
            {
                $calendario = new Calendario($ano);                
                $calendario = $calendario->HTML_ObterAno();
                //debc($calendario);                
                //debc(Calendario::defaultCSS);
            }
            {
                $logs = Logger::getYearLogs($ano);
                //deb($logs);
                $js = [];
                foreach ($logs as $log){                    
                    {
                        //deb($log);
                        extract($log);
                        $MONTH = intval($MONTH);    
                        $DAY = intval($DAY);
                    }
                    {
                        $MES2D = Numbers::str_pad_left($MONTH);
                        $DIA2D = Numbers::str_pad_left($DAY);
                        $ymd = $YEAR.$MES2D.$DIA2D;
                        $href = '/dev/log/dia/'.$ymd;                        
                        $link = '<a href="'.$href.'" title="Clique para visualizar os registros desta data.">LOG<a>';                       
                    }
                    //<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
                    //<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
                    //<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
                    $js[$MONTH.$DAY] = "$('.mes-$MONTH .dia-$DAY .conteudo').html('$link'); ";
                    //<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
                    //<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
                    //<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
                    
                }
                $js = implode(chr(10),$js);
                //deb($js);
            }
            //debc($js);
            ViewLog::PageDev('log_ano', get_defined_vars());
        });
        
        
    }
    
    
    //===================================================================================
    //===================================================================================
    //===================================================================================
    
    
}

?>